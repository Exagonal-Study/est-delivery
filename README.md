# 1주차 
## 이민의민족 - 쿠폰서비스 
이스트소프트는 최근, 배달서비스를 런칭했습니다. 해당 서비스는 MSA로 나뉘어있고 이 중 쿠폰서버의 아키텍처를 구성해야 한다는 미션을 받았습니다.
팀원들은 각 요구사항을 토대로 도메인 설계를 진행하고 요구사항을 만족해야한다. 

### 요구사항 
1. 이민의 민족 쿠폰은 할인율 쿠폰과 금액 쿠폰 두종류가 존재합니다.
2. ID는 시간대별 순서가 보장되어야합니다.
3. 쿠폰발급의 이벤트는 버튼을 통한 발급, 정기적인 발급 총 두 개입니다.
4. 동일한 쿠폰은 하루에 하나씩만 발급 가능합니다.



## Entity
### 쿠폰 설정 - CouponConfig

쿠폰 설정값을 정의한다.

|컬럼명|컬럼한글명|데이터타입|설명|
|---|---|---|--|
|id|고유번호|Long|PK|
|type|쿠폰 종류|String|쿠폰 종류를 지정한다. (DISCOUNT : 할인율 쿠폰, AMOUNT : 금액 쿠폰)|
|json|쿠폰 상세 설정값|String|쿠폰 종류에 따른 설정값을 json 형태로 저장한다.|
|createdAt|등록일|LocalDateTime|쿠폰 설정 등록일|
|updatedAt|수정일|LocalDateTime|쿠폰 설정 수정일|

### 쿠폰 - Coupon

발급된 쿠폰을 정의한다.

이미 사용자에게 발급된 쿠폰일 수도 있고, 미리 정해진 수량만큼 생성만 된 쿠폰일수도 있다.

|컬럼명| 컬럼한글명    |데이터타입| 설명                     |
|---|----------|---|------------------------|
|id| 고유번호     |Long| PK                     |
|code| 쿠폰 고유값   |String| 쿠폰번호 (분산 DB 에서도 고유한 값) |
|configId| 쿠폰 설정 ID |Long| 쿠폰 설정 ID               |
|createdAt| 등록일      |LocalDateTime| 쿠폰 등록일                 |
|updatedAt| 수정일      |LocalDateTime| 쿠폰 수정일                 |


### 사용자 쿠폰 - UserCoupon

사용자에게 발급된 쿠폰을 정의한다.

| 컬럼명            | 컬럼한글명    |데이터타입| 설명                     |
|----------------|----------|---|------------------------|
| id             | 고유번호     |Long| PK                     |
| userId         | 사용자 ID   |Long| 발급받은 사용자 ID            |
| couponCode     | 쿠폰 고유값   |String| 쿠폰번호 (분산 DB 에서도 고유한 값) |
| couponConfigId | 쿠폰 설정 ID |Long| 쿠폰 설정 ID               |
| createdAt      | 등록일      |LocalDateTime| 쿠폰 등록일                 |
| updatedAt      | 수정일      |LocalDateTime| 쿠폰 수정일                 |


## 요구사항 구현

1. 이민의 민족 쿠폰은 할인율 쿠폰과 금액 쿠폰 두종류가 존재합니다.
   - CouponConfig 에 쿠폰 종류와 종류에 따른 동작방식을 설정할 수 있도록 설계했다. (data.sql 참고)
   - 설정되지 않은 쿠폰을 호출하는 경우, API 에서는 다음과 같은 에러를 응답한다.
        ```
        {
           "code": 1001,
           "message": "not found coupon config."
        }
        ```
2. ID는 시간대별 순서가 보장되어야합니다.
   - twitter snow flake 기법을 사용하여 쿠폰 코드를 발급한다.
3. 쿠폰발급의 이벤트는 버튼을 통한 발급, 정기적인 발급 총 두 개입니다.
   - 버튼을 통한 발급은 API 호출로 처리한다.
   - 정기적인 발급은 스케줄러로 처리한다.
4. 동일한 쿠폰은 하루에 하나씩만 발급 가능합니다.
   - 사용자가 동일한 쿠폰을 발급 시도했을 경우, API 에서는 다음과 같은 에러를 응답한다.
       ```
       {
           "code": 1000,
           "message": "duplicated coupon."
       }
       ```
